(()=>{"use strict";let e=async e=>{let t=await fetch(e);if(!t.ok)throw Error(`HTTP error! status: ${t.status}`);let r=await t.text();return r?JSON.parse(r):null},t={URL:"https://"+__CUSTOMDATA__.client+".mais.social/",serverID:__CUSTOMDATA__.initials},r=!1,{URL:a}=t,n=["ageGroup","artist","author","brand","catalogColorName","catalogColorfulness","catalogPredominantColor","catalogSize","category","department","description","designer","ean","fulfillmentBy","gender","images","isExclusive","label","name","price","productId","productId2","salePrice","seller","sku","subCategory"],o=["ageGroup","artist","author","brand","catalogColorName","catalogSize","category","department","designer","fulfillmentBy","gender","label","name","seller","subCategory"],i=["ean","productId","productId2","sku"],s=class{constructor(e){this.url=e,this.url}async set(){let{productId:e,initials:t,images:r}=window.__CUSTOMDATA__||{};if(!this.isValidProductData(e,r))return;let a=this.getProps();!(!this.areUrlsValid(a)||this.isRestrictedUrl(a.url))&&await this.sendDataToApi(t,a)}isValidProductData(e,t){return!!e&&!!t}areUrlsValid(e){for(let t of["imageURL","imageURLSecondary","url"])if(e[t]&&!function(e){try{return new URL(e),!0}catch(e){return!1}}(e[t]))return!1;return!0}isRestrictedUrl(e){return["cart","checkout","checkouts","customer","carrinho"].some(t=>RegExp(`(^|/)${t}(/|$)`,"i").test(e))}async sendDataToApi(t,r){if(this.isProductInfoRepeated(r))return;let n=this.constructDataString(r),o=window.__CUSTOMDATA__.operator?`&operator=${window.__CUSTOMDATA__.operator}`:"";await e(`${a}api/pdp/product-events?ecommerceId=${t}&${n}${o}`),window.__CUSTOMDATA__.productEvents||(window.__CUSTOMDATA__.productEvents={}),window.__CUSTOMDATA__.productEvents.lastSentProductInfo={productId:r.productId,productId2:r.productId2,sku:r.sku},window.__CUSTOMDATA__.productUrl&&(window.__CUSTOMDATA__.productUrl=null)}isProductInfoRepeated(e){let t=window.__CUSTOMDATA__.productEvents?.lastSentProductInfo;return!!t&&t.productId===e.productId&&t.productId2===e.productId2&&t.sku===e.sku}constructDataString(e){return Object.keys(e).sort().map(t=>`${t}=${encodeURIComponent(e[t])}`).join("&")}getProps(){let e={};return e.url=this.url,n.forEach(t=>{let r=window.__CUSTOMDATA__;if(r&&null!==r[t]&&void 0!==r[t]){if("images"===t)window.__CUSTOMDATA__[t][0]&&(e.imageURL=window.__CUSTOMDATA__[t][0][0]||"",e.imageURLSecondary=window.__CUSTOMDATA__[t][0][1]||"");else{var a,n;let r=Array.isArray(window.__CUSTOMDATA__[t])?window.__CUSTOMDATA__[t].join(","):window.__CUSTOMDATA__[t];if(o.includes(t)&&(r=function(e,t=3169){if(!e)return e;if("string"!=typeof e&&"string"!=typeof(e=e.toString()))return null;if(/(&[a-z0-9#]{2,10};)|(<[^>]*>)/i.test(e)){var r=document.createElement("textarea");r.innerHTML=e,e=r.value}return e=function(e){let t=["and","e","de","van","von","av"],r=e.toLowerCase().split(/[\s-_]+/),a=r.map((e,r)=>{if(t.includes(e)&&0!==r)return e;{let t=e.normalize("NFD").replace(/[\u0300-\u036f]/g,""),r=t.charAt(0).toUpperCase()+e.slice(1);return r}});return a.join(" ")}(e=e.replace(/<[^>]*>/g," ").replace(/\r?\n|\r/g," ").replace(/\s+/g," ").substring(0,t).trim())}(r)),i.includes(t)&&(r=(a=r)?"string"!=typeof a&&"string"!=typeof(a=a.toString())?null:a=(a=a.replace(/\s+/g,"")).toLowerCase():a),"description"===t&&(r=function(e,t=3169){try{var r;if(!e||("string"!=typeof e&&(e=e.toString()),"string"!=typeof e))return null;let a=document.createElement("textarea"),n=/([.!?])$/;r=e=(e=e.replace(/<(script|style)[^>]*>[\s\S]*?<\/\1>/gi,"")).replace(/<!--[\s\S]*?-->/g,""),a.innerHTML=r,(e=(e=(e=(e=(e=a.value).replace(/(<(h[1-6]|p)[^>]*>)([^<]*)(<\/\2>)/gi,(e,t,r,a,o)=>n.test(a.trim())?e:`${t}${a.trim()}: ${o}`)).replace(/<[^>]*>/g,"")).replace(/\s?[¹²³⁴⁵⁶⁷⁸⁹*]+/g,"")).replace(/\. \.([0-9]+)/g,". $1").replace(/\.\./g,".").replace(/\s\?/g,"?").replace(/\r?\n|\r/g," ").replace(/\s+/g," ").trim()).length>0&&(e=e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()),e=(e=e.replace(/([.!?]\s*)([a-záéíóúãõâêôç])/g,(e,t,r)=>t+r.toUpperCase())).replace(/([.!?])(\s+)([a-záéíóúãõâêôç])/g,(e,t,r,a)=>t+" "+a.toUpperCase());let o=e.lastIndexOf(".");return -1!==o&&(e=e.slice(0,o+1)),e.substring(0,t).trim()}catch(e){return null}}(r)),"price"===t||"salePrice"===t){"string"!=typeof(n=r)&&(n=String(n)),r=n=parseFloat(n=(n=n.trim()).includes(".")?n.replace(/[^0-9.]/g,""):(n=n.replace(/[^0-9,]/g,"")).replace(",",".")).toFixed(2)}e[t]=r,e[t]}}}),e}};async function l(e){if(!e)return;r||(console.info("%cVurdere%cis loaded: harnessing Social+ AI and Elegance to boost your store's engagement and conversions.","background: black; color: #FFA100; font-weight: bold; padding: 3px;","background: black; color: white; padding: 3px;"),r=!0);let t=new s(e);await t.set()}let c=((e,t,r)=>{let a;return function(...t){let n=this,o=()=>{a=null,r||e.apply(n,t)},i=r&&!a;clearTimeout(a),a=setTimeout(o,500),i&&e.apply(n,t)}})(l,0,!0);window.vurdereSendSocialEvents=c})();